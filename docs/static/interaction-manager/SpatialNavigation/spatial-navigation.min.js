var spatialNavigation=(()=>{var c=(l,t)=>()=>(l&&(t=l(l=0)),t);var P=(l,t)=>()=>(t||l((t={exports:{}}).exports,t),t.exports);function x(l){return l*180/Math.PI}var O=c(()=>{});var d,a,f=c(()=>{d=class{constructor(){this.actions=[],this.keyboardFunctions=[],this.gamepadFunctions=[]}init(){window._IM||(window._IM=new d)}getKeys(t){return _IM.keyboardFunctions.filter(e=>e.keys.every(n=>t.includes(n)))}getKeysIndex(t){return _IM.keyboardFunctions.findIndex(e=>e.keys.every(n=>t.includes(n)))}getGamepadAction(t){return _IM.gamepadFunctions.find(e=>e.actions.every(n=>t.includes(n)))}getGamepadActionIndex(t){return _IM.gamepadFunctions.findIndex(e=>e.actions.every(n=>t.includes(n)))}getAction(t){return _IM.actions.find(e=>e.name===t)}getActionIndex(t){return _IM.actions.findIndex(e=>e.name===t)}},a=new d});var m,u,g=c(()=>{f();m=class{register(t,e){if(a.getAction(t))return console.error(`The following action "${t}" is already registered!`);_IM.actions.push({name:t,callback:e})}remove(t){let e=a.getActionIndex(t);if(e===-1)return console.error(`${t} is not a registered action!`);_IM.actions.splice(e,1)}execute(t,e){let n=a.getAction(t);if(!n)return console.error(`${t} is not a registered action!`);n.callback(e)}},u=new m});var b,C=c(()=>{b={ALT:18,ARROW_DOWN:40,ARROW_LEFT:37,ARROW_RIGHT:39,ARROW_UP:38,BACKSPACE:8,CAPS_LOCK:20,CTRL:17,DELETE:46,END:35,ENTER:13,ESC:27,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,HOME:36,INSERT:45,NUM_LOCK:144,NUMPAD_DASH:109,NUMPAD_STAR:106,NUMPAD_DOT:110,NUMPAD_FORWARD_SLASH:111,NUMPAD_PLUS:107,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,PAGE_DOWN:34,PAGE_UP:33,PAUSE:19,PRINT_SCRN:44,SCROLL_LOCK:145,SHIFT:16,SPACEBAR:32,TAB:9,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,0:48,QUOTE:222,DASH:189,COMMA:188,DOT:190,FORWARD_SLASH:191,SEMI_COLON:186,SQUARE_BRACKET_LEFT:219,SQUARE_BRACKET_RIGHT:221,BACKWARD_SLASH:220,BACKTICK:192,EQUAL:187,SYSTEM:91}});var T,E,D=c(()=>{f();C();g();T=class{constructor(){this.mappings=b,this.eventListenerAttached=!1,this.keysPressed=new Set,this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),window.KEYS||(window.KEYS=b)}on(t){t.keys=[...new Set(t.keys.map(i=>(i=typeof i=="number"?this.keyCodeToString(i):i,i.toUpperCase())))];let e=t.keys.filter(i=>!this.mappings[i]);if(e.length>0)return console.error(`The following keys [${e.join(", ")}] you have entered are incorrect! `);this.eventListenerAttached||(document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),this.eventListenerAttached=!0);let n=a.getKeys(t.keys);if(n.length>0&&n.some(i=>i.type===t.type))return console.error("You are trying to overwrite an existing key combination! To do that, first remove it with .off([keys]) then add it again");if(t.type==="lift"&&t.keys.length>1)return console.error("You can only have a single key trigger an action on lift");_IM.keyboardFunctions.push(t)}off(t){let e=a.getKeysIndex(t);if(e===-1)return console.error("You are trying to remove a non-existent key combination!");_IM.keyboardFunctions.splice(e,1),_IM.keyboardFunctions.length===0&&(document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),this.eventListenerAttached=!1)}onKeyDown(t){let e=this.keyCodeToString(t.keyCode);this.keysPressed.add(e);let n=a.getKeys([...this.keysPressed]);n.length!==0&&n.forEach(i=>{i.type==="press"&&t.repeat||i.type!=="press"&&i.type!=="hold"||i.type==="hold"&&!t.repeat||this.executeCallback(t,i)})}onKeyUp(t){let e=this.keyCodeToString(t.keyCode);this.keysPressed.delete(e);let n=a.getKeys(e);if(n.length===0)return;let i=n.find(o=>o.type==="lift");!i||this.executeCallback(t,i)}keyCodeToString(t){return Object.keys(this.mappings).find(e=>this.mappings[e]===t)}executeCallback(t,e){if(typeof e.callback=="string")return u.execute(e.callback,t);e.callback(t)}},E=new T});var S,F=c(()=>{S={FACE_BUTTON_DOWN:0,FACE_BUTTON_RIGHT:1,FACE_BUTTON_LEFT:2,FACE_BUTTON_UP:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_SHOULDER_BOTTOM:6,RIGHT_SHOULDER_BOTTOM:7,SELECT:8,START:9,LEFT_ANALOGUE_STICK:10,RIGHT_ANALOGUE_STICK:11,PAD_UP:12,PAD_DOWN:13,PAD_LEFT:14,PAD_RIGHT:15,CENTER_BUTTON:16,aliases:{"playstation.x":"FACE_BUTTON_DOWN","playstation.square":"FACE_BUTTON_LEFT","playstation.circle":"FACE_BUTTON_RIGHT","playstation.triangle":"FACE_BUTTON_TOP","playstation.l1":"LEFT_SHOULDER","playstation.r1":"RIGHT_SHOULDER","playstation.l2":"LEFT_SHOULDER_BOTTOM","playstation.r2":"RIGHT_SHOULDER_BOTTOM","playstation.share":"SELECT","playstation.options":"START","playstation.l3":"LEFT_ANALOGUE_STICK","playstation.r3":"RIGHT_ANALOGUE_STICK","playstation.d-pad-up":"PAD_UP","playstation.d-pad-down":"PAD_DOWN","playstation.d-pad-left":"PAD_LEFT","playstation.d-pad-right":"PAD_RIGHT","playstation.center":"CENTER_BUTTON","xbox.a":"FACE_BUTTON_DOWN","xbox.x":"FACE_BUTTON_LEFT","xbox.b":"FACE_BUTTON_RIGHT","xbox.y":"FACE_BUTTON_TOP","xbox.lb":"LEFT_SHOULDER","xbox.rb":"RIGHT_SHOULDER","xbox.lt":"LEFT_SHOULDER_BOTTOM","xbox.rt":"RIGHT_SHOULDER_BOTTOM","xbox.view":"SELECT","xbox.menu":"START","xbox.left-thumbstick":"LEFT_ANALOGUE_STICK","xbox.right-thumbstick":"RIGHT_ANALOGUE_STICK","xbox.d-pad-up":"PAD_UP","xbox.d-pad-down":"PAD_DOWN","xbox.d-pad-left":"PAD_LEFT","xbox.d-pad-right":"PAD_RIGHT","xbox.center":"CENTER_BUTTON"},axisAliases:["right.joystick","left.joystick","left.joystick.down","left.joystick.up","left.joystick.left","left.joystick.right","right.joystick.down","right.joystick.up","right.joystick.left","right.joystick.right"]}});var h,_,A,L=c(()=>{F();f();g();h=.9,_=class{constructor(){this.mappings=S,this.pollingStarted=!1,this.gamepadEnabled=!1,this.onGamepadConnected=this.onGamepadConnected.bind(this),this.sanitizeAction=this.sanitizeAction.bind(this),this.lessSensitive=!1}set enabled(t){this.gamepadEnabled=t,this.gamepadEnabled?this.init():this.deinit()}init(){window.addEventListener("gamepadconnected",this.onGamepadConnected)}deinit(){window.removeEventListener("gamepadconnected",this.onGamepadConnected)}onGamepadConnected(){this.pollingStarted||(this.pollingStarted=!0,this.startPolling())}on(t){t.actions=t.actions.map(this.sanitizeAction);let e=this.mappings.axisAliases.some(n=>t.actions.includes(n));if(t.actions.length>1&&e)return console.error("You can't use an axis action in a combination with a button action");if(a.getGamepadAction(t.actions))return console.error("You have already registered a callback for this action. If you want to overwrite it, remove it first with .off([actions])");_IM.gamepadFunctions.push(t)}off(t){let e=a.getGamepadActionIndex(t);if(e===-1)return console.error("You are trying to remove a non-existent action!");_IM.gamepadFunctions.splice(e,1)}startPolling(){let t=navigator.getGamepads();if(t.length===0){this.pollingStarted=!1;return}if(t.forEach((e,n)=>{!e||(this.handleButtons(e.buttons,n),this.handleJoysticks(e.axes))}),this.lessSensitive){setTimeout(this.startPolling,100);return}requestAnimationFrame(()=>this.startPolling())}handleButtons(t){let e=t.reduce((i,o,s)=>(o.pressed&&(i.buttonIndexes.push(s),i.buttons.push(o)),i),{buttonIndexes:[],buttons:[]}),n=a.getGamepadAction(e.buttonIndexes);!n||this.executeCallback(n,e.buttons)}handleJoysticks(t){this.getJoystickActions().forEach(n=>{switch(n.actions[0]){case"left.joystick":return this.executeCallback(n,[t[0],t[1]]);case"right.joystick":return this.executeCallback(n,[t[2],t[3]]);case"left.joystick.down":if(t[1]>h)return this.executeCallback(n,[t[0],t[1]]);break;case"left.joystick.up":if(t[1]<-h)return this.executeCallback(n,[t[0],t[1]]);break;case"left.joystick.left":if(t[0]<-h)return this.executeCallback(n,[t[0],t[1]]);break;case"left.joystick.right":if(t[0]>h)return this.executeCallback(n,[t[0],t[1]]);break;case"right.joystick.down":if(t[3]>h)return this.executeCallback(n,[t[2],t[3]]);break;case"right.joystick.up":if(t[3]<-h)return this.executeCallback(n,[t[2],t[3]]);break;case"right.joystick.left":if(t[2]<-h)return this.executeCallback(n,[t[2],t[3]]);break;case"right.joystick.right":if(t[2]>h)return this.executeCallback(n,[t[2],t[3]]);break}})}sanitizeAction(t){if(typeof t=="number")return t;if(this.mappings.axisAliases.includes(t.toLowerCase()))return t.toLowerCase();if(typeof t=="string"){let e=this.mappings.aliases[t.toLowerCase()];return e?this.mappings[e]:console.error(`You have entered a non-supported button alias ${t}`)}return t}getJoystickActions(){return _IM.gamepadFunctions.filter(t=>this.mappings.axisAliases.includes(t.actions[0]))}executeCallback(t,e){if(typeof t.callback=="string")return u.execute(t.callback,e);t.callback(e)}},A=new _});var U,k,I,w=c(()=>{O();g();D();L();U=["down","up","left","right"],k=class{constructor(){this.enabled=!1,this.navigatableElements={default:[]}}init(t=[]){this.enabled||(this.enabled=!0,this.add(t),this.registerKeyActions())}deinit(){!this.enabled||(this.enabled=!1,this.navigatableElements={default:[]},this.removeKeyActions())}add(t){!this.enabled||t.forEach(e=>{typeof e=="string"?this.handleString(e):this.handleObject(e)})}remove(t="default"){if(!!this.enabled){if(!this.navigatableElements[t])return console.error(`The area '${t}' you are trying to remove doesn't exist`);this.navigatableElements[t].forEach(e=>e.removeAttribute("tabindex")),this.navigatableElements[t].length=0}}handleString(t){let e=document.querySelectorAll(t);if(e.length===0)return console.error(`${t} is either not a correct selector or the element is not present in the DOM.`);e.forEach(this.makeFocusable),this.navigatableElements.default.push(...e)}handleObject(t){let e=t.elements.reduce((n,i)=>{let o=document.querySelectorAll(i);return o.forEach(this.makeFocusable),n.push(...o),n},[]);if(e.length===0)return console.error(`${t.elements.join(", ")} are either not a correct selectors or the elements are not present in the DOM.`);this.navigatableElements[t.area]||(this.navigatableElements[t.area]=[]),this.navigatableElements[t.area].push(...e)}makeFocusable(t){t.setAttribute("tabindex",1)}getFocusableGroup(){let t=document.activeElement;return Object.values(this.navigatableElements).reduce((e,n)=>(n.includes(t)&&(e=n.reduce((i,o)=>{if(o!==t&&!o.hasAttribute("disabled")){let{x:s,y:r,height:p,width:y}=o.getBoundingClientRect();i.push({element:o,x:s,y:r,height:p,width:y})}return i},[])),e),[])}getClosestToEdge(t,e,n){let i,o;return e.reduce((s,r)=>{switch(t){case"down":i=Math.hypot(r.x-n.x,r.y),o=Math.hypot(s.x-n.x,s.y);break;case"up":i=Math.hypot(r.x-n.x,window.innerHeight-r.y),o=Math.hypot(s.x-n.x,window.innerHeight-s.y);break;case"right":i=Math.hypot(r.x,r.y-n.y),o=Math.hypot(s.x,s.y-n.y);break;case"left":i=Math.hypot(window.innerWidth-r.x,r.y-n.y),o=Math.hypot(window.innerWidth-s.x,s.y-n.y);break}return s=i<o?r:s,s})}moveFocus(t){if(!this.enabled)return;let e=this.getFocusableGroup(),{x:n,y:i}=document.activeElement.getBoundingClientRect();if(e.length===0)return;let o=e.reduce((s,r)=>{let p=r.x-n,y=r.y-i,M=x(Math.atan2(y,p));if(this.getDirectionAngle(t,M)){s||(s=r);let v=Math.hypot(p,y),N=Math.hypot(s.y-i,s.x-n);s=v<N?r:s}return s},null);o||(o=this.getClosestToEdge(t,e,{x:n,y:i})),o.element.focus()}getDirectionAngle(t,e){switch(t){case"down":return e>0&&e<180;case"up":return e>-180&&e<0;case"left":return e<-90||e>90;case"right":return e>-90&&e<90}}registerKeyActions(){U.forEach(t=>{let e=()=>{this.moveFocus(t)};u.register(`move-focus-${t}`,e),E.on({keys:[`arrow_${t}`],callback:`move-focus-${t}`,type:"press"}),A.on({actions:[`playstation.d-pad-${t}`],callback:`move-focus-${t}`})})}removeKeyActions(){U.forEach(t=>{u.remove(`move-focus-${t}`),E.off([`arrow-${t}`]),A.off([`playstation.d-pad-${t}`])})}focusFirst(t="default"){let e=this.navigatableElements[t];if(!e||e.length===0)return console.error(`The area '${t}' you are trying to focus doesn't exist or the spatial navigation hasn't been initialized`);e[0].focus()}focusLast(t="default"){if(!this.enabled)return;let e=this.navigatableElements[t];if(!e||e.length===0)return console.error(`The area '${t}' you are trying to focus doesn't exist or the spatial navigation hasn't been initialized`);e.slice(-1)[0].focus()}switchArea(t){this.focusFirst(t)}isActiveElementInGroup(){return Object.values(this.navigatableElements).some(t=>t.includes(document.activeElement))}clearFocus(){this.isActiveElementInGroup()&&document.activeElement.blur()}},I=new k});var H=P((lt,R)=>{w();f();a.init();R.exports=I});return H();})();
//# sourceMappingURL=spatial-navigation.min.js.map
